---
import Base from '@/layouts/Base.astro';
import WorkCard from '@/components/WorkCard.astro';
import WorksFilter from '@/components/WorksFilter.astro';
import { getCollection } from 'astro:content';

const works = await getCollection('works');

const categoryOrder = [
  'major-theological',
  'quaestiones-disputatae',
  'opuscula',
  'aristotle-commentary',
  'biblical-commentary',
  'other-commentary',
  'popular',
];

const categoryLabels: Record<string, string> = {
  'major-theological': 'Major Theological Works',
  'quaestiones-disputatae': 'Quaestiones Disputatae',
  'opuscula': 'Opuscula',
  'aristotle-commentary': 'Commentaries on Aristotle',
  'biblical-commentary': 'Biblical Commentaries',
  'other-commentary': 'Other Commentaries',
  'popular': 'Popular Works',
};

const categoryDescriptions: Record<string, string> = {
  'major-theological': 'The great systematic theological works',
  'quaestiones-disputatae': 'Disputed questions on theological topics',
  'opuscula': 'Shorter philosophical and theological treatises',
  'aristotle-commentary': 'Commentaries on the works of Aristotle',
  'biblical-commentary': 'Commentaries on Sacred Scripture',
  'other-commentary': 'Commentaries on other philosophical works',
  'popular': 'Catechetical and devotional writings',
};

const categoryLabelsShort: Record<string, string> = {
  'major-theological': 'Major',
  'quaestiones-disputatae': 'Quaestiones',
  'opuscula': 'Opuscula',
  'aristotle-commentary': 'Aristotle',
  'biblical-commentary': 'Biblical',
  'other-commentary': 'Other',
  'popular': 'Popular',
};

const worksByCategory = works.reduce((acc, work) => {
  const category = work.data.category;
  if (!acc[category]) acc[category] = [];
  acc[category].push(work);
  return acc;
}, {} as Record<string, typeof works>);

// Sort each category's works alphabetically by title
for (const category of Object.keys(worksByCategory)) {
  worksByCategory[category].sort((a, b) => a.data.title.localeCompare(b.data.title));
}

// Build categories for filter
const filterCategories = categoryOrder
  .filter(cat => worksByCategory[cat]?.length > 0)
  .map(cat => ({
    id: cat,
    label: categoryLabelsShort[cat],
    count: worksByCategory[cat].length,
  }));
---

<Base title="Works" description="Complete list of St. Thomas Aquinas' works available in Latin and English">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li><a href="/">Home</a></li>
      <li><span class="separator">&#10095;</span></li>
      <li aria-current="page">Works</li>
    </ol>
  </nav>

  <header class="page-header">
    <h1>Works of St. Thomas Aquinas</h1>
    <p class="intro">
      Browse the complete collection of available texts. Works marked with
      <span class="badge-example">LA + EN</span> present the original Latin alongside English translation.
    </p>
  </header>

  <WorksFilter categories={filterCategories} />

  <div class="works-content">
    {categoryOrder.map((category) => {
      const categoryWorks = worksByCategory[category];
      if (!categoryWorks || categoryWorks.length === 0) return null;

      return (
        <section class="category-section" id={category}>
          <div class="category-header">
            <div class="category-title-wrapper">
              <h2>{categoryLabels[category]}</h2>
              <span class="category-count">{categoryWorks.length} works</span>
            </div>
            <p class="category-description">{categoryDescriptions[category]}</p>
          </div>
          <div class="works-grid">
            {categoryWorks.map((work) => (
              <WorkCard
                id={work.id}
                title={work.data.title}
                latinTitle={work.data.latinTitle}
                category={work.data.category}
                latinEnglishPath={work.data.languages.latinEnglish}
                englishPath={work.data.languages.english}
                restricted={work.data.restricted}
              />
            ))}
          </div>
        </section>
      );
    })}
  </div>

  <style>
    .breadcrumb {
      margin-bottom: 2rem;
      font-family: var(--font-sans);
      font-size: 0.85rem;
    }

    .breadcrumb ol {
      display: flex;
      flex-wrap: wrap;
      list-style: none;
      align-items: center;
      gap: 0.5rem;
    }

    .breadcrumb a {
      color: var(--color-text-muted);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    .breadcrumb a:hover {
      color: var(--color-accent);
      text-decoration: underline;
    }

    .breadcrumb .separator {
      color: var(--color-border);
      font-size: 0.7rem;
    }

    .breadcrumb li[aria-current="page"] {
      color: var(--color-text);
      font-weight: 500;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--color-border);
    }

    h1 {
      margin-bottom: 0.75rem;
    }

    .intro {
      color: var(--color-text-muted);
      max-width: 550px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .badge-example {
      display: inline-block;
      font-family: var(--font-sans);
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      padding: 0.15rem 0.35rem;
      background-color: var(--color-accent);
      color: #ffffff;
      border-radius: 2px;
      vertical-align: middle;
    }

    .works-content {
      margin-top: 1rem;
    }

    .category-section {
      margin-bottom: 3rem;
    }

    .category-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--color-border);
    }

    .category-title-wrapper {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.35rem;
    }

    .category-section h2 {
      margin-bottom: 0;
      color: var(--color-text);
    }

    .category-count {
      font-family: var(--font-sans);
      font-size: 0.8rem;
      color: var(--color-text-muted);
      background-color: var(--color-bg-alt);
      padding: 0.25rem 0.625rem;
      border-radius: 12px;
    }

    .category-description {
      font-style: italic;
      color: var(--color-text-muted);
      font-size: 0.95rem;
      margin: 0;
    }

    .works-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.25rem;
    }

    @media (max-width: 600px) {
      .page-header {
        text-align: left;
      }

      .intro {
        margin: 0;
      }

      .category-title-wrapper {
        flex-direction: column;
        align-items: flex-start;
      }

      .works-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</Base>
